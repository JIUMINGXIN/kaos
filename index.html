<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>软件项目管理练习系统</title>
    <!-- 基础样式与库加载：使用 CDN 确保在任何环境下都能运行 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', system-ui, -apple-system, sans-serif; -webkit-tap-highlight-color: transparent; }
        .animate-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        button:active { transform: scale(0.97); }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- 稳定版内置图标 ---
        const IconBook = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>;
        const IconPlay = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>;
        const IconStar = ({ filled }) => <svg width="24" height="24" viewBox="0 0 24 24" fill={filled ? "#fbbf24" : "none"} stroke={filled ? "#fbbf24" : "currentColor"} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>;
        const IconHome = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>;
        const IconAward = () => <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline></svg>;
        const IconCheck = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>;
        const IconX = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>;
        const IconList = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>;

        // --- 完整题目库 (1-16章) ---
        const RAW_DATA = [
            // 第一章
            { ch: "第一章", t: "judgment", q: "搬家属于项目。", o: ["正确", "错误"], a: "正确" },
            { ch: "第一章", t: "judgment", q: "项目是为了创造唯一的产品或提供唯一的服务而进行的永久性的努力。", o: ["正确", "错误"], a: "错误" },
            { ch: "第一章", t: "judgment", q: "过程管理的目的是要让过程能够被共享、复用,并得到持续的改进。", o: ["正确", "错误"], a: "正确" },
            { ch: "第一章", t: "judgment", q: "项目具有临时性的特征。", o: ["正确", "错误"], a: "正确" },
            { ch: "第一章", t: "judgment", q: "日常运作存在大量的变更管理,而项目基本保持连贯性。", o: ["正确", "错误"], a: "错误" },
            { ch: "第一章", t: "judgment", q: "相比于传统开发的预测性过程,敏捷开发属于自适应过程。", o: ["正确", "错误"], a: "正确" },
            { ch: "第一章", t: "single", q: "下列选项中不是项目与日常运作的区别的是( )。", o: ["项目是以目标为导向的", "项目是通过项目经理及其团队的工作完成的", "项目需要有专业知识的人完成,而日常运作不需要", "项目是一次性的,日常运作是重复进行的"], a: "项目需要有专业知识的人完成,而日常运作不需要" },
            { ch: "第一章", t: "single", q: "下面哪一项不是《PMBOK指南》(第6版)中的知识领域?( )", o: ["招聘管理", "质量管理", "范围管理", "风险管理"], a: "招聘管理" },
            
            // 第二章
            { ch: "第二章", t: "judgment", q: "项目立项可以确立项目目标、时间和资源成本,同时得到项目发起人的认可。", o: ["正确", "错误"], a: "正确" },
            { ch: "第二章", t: "judgment", q: "项目招标对于一个项目的开发是必需的,即便项目是内部项目。", o: ["正确", "错误"], a: "错误" },
            { ch: "第二章", t: "judgment", q: "自主开发相当于自制-购买决策中的自制。", o: ["正确", "错误"], a: "正确" },
            { ch: "第二章", t: "judgment", q: "乙方即供方(有时也称为卖方)是为顾客提供产品或服务的一方。", o: ["正确", "错误"], a: "正确" },
            { ch: "第二章", t: "judgment", q: "敏捷项目强调仆人式的管理方式。", o: ["正确", "错误"], a: "正确" },
            { ch: "第二章", t: "single", q: "以下哪一项不包括在项目章程中?( )", o: ["对项目的确认", "对项目经理的授权", "对项目风险的分析", "项目目标的概述"], a: "对项目风险的分析" },
            { ch: "第二章", t: "single", q: "PMI人才三角不包括下面哪一项?( )", o: ["技术项目管理", "测试能力", "领导力", "战略和商务管理"], a: "测试能力" },

            // 第三章
            { ch: "第三章", t: "judgment", q: "瀑布模型不适合短期项目。", o: ["正确", "错误"], a: "错误" },
            { ch: "第三章", t: "judgment", q: "增量式模型可以避免一次性投资太多带来的风险。", o: ["正确", "错误"], a: "正确" },
            { ch: "第三章", t: "judgment", q: "V模型适合需求明确且对性能要求严格的项目。", o: ["正确", "错误"], a: "正确" },
            { ch: "第三章", t: "single", q: "下面哪一项属于预测型生存期模型?( )", o: ["瀑布模型", "增量模型", "Scrum 模型", "原型模型"], a: "瀑布模型" },

            // 第四章
            { ch: "第四章", t: "judgment", q: "需求规约说明可以包括系统的运行环境。", o: ["正确", "错误"], a: "正确" },
            { ch: "第四章", t: "judgment", q: "数据流分析方法是一种自下而上逐步求精的分析方法。", o: ["正确", "错误"], a: "错误" },
            { ch: "第四章", t: "single", q: "用户故事 INVEST准则中“S”的含义是( )。", o: ["独立的", "足够小", "可估计的", "可测试的"], a: "足够小" },

            // 第五章
            { ch: "第五章", t: "judgment", q: "WBS 提供了项目范围基线。", o: ["正确", "错误"], a: "正确" },
            { ch: "第五章", t: "single", q: "WBS 之所以重要有以下原因,除了( )。", o: ["确定范围基准", "防止遗漏工作", "为估算提供依据", "确定项目经理"], a: "确定项目经理" },

            // 第六章
            { ch: "第六章", t: "judgment", q: "故事点估算是一个相对的估算过程。", o: ["正确", "错误"], a: "正确" },
            { ch: "第六章", t: "single", q: "三点估算选择的三种值不包括如下哪一项?( )", o: ["最可能成本", "最乐观成本", "最悲观成本", "项目经理估算值"], a: "项目经理估算值" },

            // 第七章
            { ch: "第七章", t: "judgment", q: "在PDM 网络图中,节点表示活动,箭线表示逻辑关系。", o: ["正确", "错误"], a: "正确" },
            { ch: "第七章", t: "single", q: "下面哪种图示可以表示敏捷项目进度,并且可以表示出剩余任务?( )", o: ["燃起图", "燃尽图", "里程碑图", "网络图"], a: "燃尽图" },

            // 第八章
            { ch: "第八章", t: "judgment", q: "软件质量是软件满足明确说明或者隐含的需求的程度。", o: ["正确", "错误"], a: "正确" },
            { ch: "第八章", t: "single", q: "项目质量管理的目标是满足( )的需要。", o: ["老板", "项目经理", "项目", "组织"], a: "项目" },

            // 第九章
            { ch: "第九章", t: "judgment", q: "有效的项目管理能够控制变化,应对变化。", o: ["正确", "错误"], a: "正确" },
            { ch: "第九章", t: "single", q: "变更控制主要关注的是( )。", o: ["阻止变更", "标识/提出/管理变更", "管理 SCCB", "客户的想法"], a: "标识/提出/管理变更" },

            // 第十章
            { ch: "第十章", t: "judgment", q: "责任分配矩阵是明确团队成员角色与职责的有效工具。", o: ["正确", "错误"], a: "正确" },
            { ch: "第十章", t: "single", q: "在( )组织结构中,项目成员没有安全感。", o: ["职能型", "矩阵型", "项目型", "弱矩阵型"], a: "项目型" },

            // 第十一章
            { ch: "第十一章", t: "judgment", q: "任何项目都是有风险的。", o: ["正确", "错误"], a: "正确" },
            { ch: "第十一章", t: "single", q: "下列不属于风险评估方法的是( )。", o: ["盈亏平衡分析", "模拟法", "决策树分析", "二叉树分析"], a: "二叉树分析" },

            // 第十二章
            { ch: "第十二章", t: "judgment", q: "成本加激励费用(CPIF)合同具有激励机制。", o: ["正确", "错误"], a: "正确" },
            { ch: "第十二章", t: "single", q: "卖方承担风险最大的合同类型是( )。", o: ["成本加固定费用", "成本加激励费用", "成本加奖金", "固定总价"], a: "固定总价" },

            // 第十三章
            { ch: "第十三章", t: "judgment", q: "软件项目管理最重要的4个要素是范围、质量、进度、风险。", o: ["正确", "错误"], a: "错误" },
            { ch: "第十三章", t: "single", q: "各个目标(进度/成本/质量/范围)之间( )。", o: ["相互独立", "相互关联和制约", "进度最重要", "无关"], a: "相互关联和制约" },

            // 第十四章
            { ch: "第十四章", t: "judgment", q: "累计费用曲线中ACWP比BCWS高,意味着实际成本比计划高。", o: ["正确", "错误"], a: "正确" },
            { ch: "第十四章", t: "single", q: "如果CPI=90%,则说明( )。", o: ["超出计划90%", "投入1元产生0.9元效果", "完成计划90%", "超支90%"], a: "投入1元产生0.9元效果" },

            // 第十五章
            { ch: "第十五章", t: "judgment", q: "敏捷生存期模型中的每天站立会议是一种很有效的沟通方式。", o: ["正确", "错误"], a: "正确" },
            { ch: "第十五章", t: "single", q: "“为什么大家不能都让一步解决这个问题呢?”属于( )解决方法。", o: ["解决问题", "妥协", "强迫方式", "撤退"], a: "妥协" },

            // 第十六章
            { ch: "第十六章", t: "judgment", q: "只有项目成功完成了,才说明项目结束了。", o: ["正确", "错误"], a: "错误" },
            { ch: "第十六章", t: "single", q: "软件项目收尾工作不包括( )。", o: ["人员角色选择", "范围确认", "质量验收", "费用决算"], a: "人员角色选择" }
        ];

        const ALL_QUESTIONS = RAW_DATA.map((item, idx) => ({
            id: idx, chapter: item.ch, type: item.t, question: item.q, options: item.o, answer: item.a
        }));

        // --- 主程序 ---
        function App() {
            const [view, setView] = useState('menu');
            const [questions, setQuestions] = useState([]);
            const [currentIndex, setCurrentIndex] = useState(0);
            const [selected, setSelected] = useState(null);
            const [score, setScore] = useState(0);
            const [history, setHistory] = useState([]);
            const [title, setTitle] = useState('');
            const [exitConfirm, setExitConfirm] = useState(false);
            const [favorites, setFavorites] = useState(() => {
                const saved = localStorage.getItem('spm_fav_final_v3');
                return saved ? JSON.parse(saved) : [];
            });

            useEffect(() => { localStorage.setItem('spm_fav_final_v3', JSON.stringify(favorites)); }, [favorites]);

            const shuffle = (arr) => {
                const newArr = [...arr];
                for (let i = newArr.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArr[i], newArr[j]] = [newArr[j], newArr[i]];
                }
                return newArr;
            };

            const start = (mode, param) => {
                let source = [];
                if (mode === 'all') { source = ALL_QUESTIONS; setTitle('综合模拟测试'); }
                else if (mode === 'chapter') { source = ALL_QUESTIONS.filter(q => q.chapter === param); setTitle(`${param}专项练习`); }
                else if (mode === 'fav') { source = ALL_QUESTIONS.filter(q => favorites.includes(q.id)); setTitle('我的收藏本'); }

                if (source.length === 0) { alert("没有找到题目"); return; }
                const final = shuffle(source).map(q => ({ ...q, options: q.type === 'single' ? shuffle(q.options) : q.options }));
                setQuestions(final); setView('quiz'); setCurrentIndex(0); setScore(0); setHistory([]); setSelected(null); setExitConfirm(false);
            };

            const chapters = ["第一章", "第二章", "第三章", "第四章", "第五章", "第六章", "第七章", "第八章", "第九章", "第十章", "第十一章", "第十二章", "第十三章", "第十四章", "第十五章", "第十六章"];

            if (view === 'menu') {
                return (
                    <div className="min-h-screen p-4 flex items-center justify-center bg-indigo-50">
                        <div className="w-full max-w-4xl bg-white rounded-[2.5rem] shadow-2xl overflow-hidden flex flex-col md:flex-row animate-in">
                            <div className="bg-indigo-600 p-12 text-white md:w-1/3 flex flex-col justify-center items-center text-center">
                                <div className="mb-6 bg-white/20 p-5 rounded-[2rem]"><IconBook /></div>
                                <h1 className="text-3xl font-black">软件项目管理</h1>
                                <p className="opacity-70 mt-4 text-sm font-medium">1-16章 全真题库系统</p>
                            </div>
                            <div className="p-8 md:w-2/3 overflow-y-auto max-h-[85vh] custom-scrollbar">
                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-10">
                                    <button onClick={() => start('all')} className="flex flex-col items-center justify-center p-8 bg-indigo-600 text-white rounded-[2rem] hover:bg-indigo-700 transition shadow-xl">
                                        <IconPlay /><span className="mt-3 font-bold text-lg">综合模拟测试</span>
                                    </button>
                                    <button onClick={() => start('fav')} className="flex flex-col items-center justify-center p-8 bg-white border-2 border-indigo-100 text-indigo-600 rounded-[2rem] hover:border-indigo-400 transition shadow-sm">
                                        <div className="text-yellow-500"><IconStar filled={true} /></div>
                                        <span className="mt-3 font-bold text-lg">我的收藏本 ({favorites.length})</span>
                                    </button>
                                </div>
                                <h3 className="font-bold text-slate-800 mb-6 flex items-center">
                                    <IconList /><span className="ml-2">按章节专项练习</span>
                                </h3>
                                <div className="grid grid-cols-2 sm:grid-cols-4 gap-3">
                                    {chapters.map(c => (
                                        <button key={c} onClick={() => start('chapter', c)} className="text-xs bg-slate-50 border border-slate-200 py-4 rounded-2xl hover:bg-indigo-50 hover:border-indigo-300 transition font-bold text-slate-600">{c}</button>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            if (view === 'result') {
                const wrong = history.filter(h => !h.isCorrect);
                return (
                    <div className="min-h-screen p-4 overflow-y-auto custom-scrollbar bg-slate-50 animate-in">
                        <div className="max-w-2xl mx-auto bg-white p-10 rounded-[3rem] shadow-xl text-center space-y-8">
                            <div className="text-yellow-500 flex justify-center transform scale-125"><IconAward /></div>
                            <h2 className="text-4xl font-black text-slate-800">测试结果</h2>
                            <div className="inline-block bg-indigo-50 px-12 py-8 rounded-[2.5rem]">
                                <span className="text-7xl font-black text-indigo-600">{score}</span>
                                <span className="text-3xl text-indigo-200 mx-3">/</span>
                                <span className="text-3xl text-indigo-400">{questions.length}</span>
                            </div>
                            <button onClick={() => setView('menu')} className="w-full bg-indigo-600 text-white py-5 rounded-2xl font-bold shadow-2xl">返回主菜单</button>
                            {wrong.length > 0 && (
                                <div className="text-left border-t pt-10">
                                    <h3 className="font-black text-red-500 text-xl mb-6 flex items-center"><IconX /> <span className="ml-2">错题解析</span></h3>
                                    <div className="space-y-4">
                                        {wrong.map((h, i) => (
                                            <div key={i} className="p-6 border-2 border-slate-50 rounded-[2rem] space-y-4">
                                                <p className="font-bold text-slate-800 text-lg leading-relaxed">{h.question.question}</p>
                                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm">
                                                    <div className="bg-red-50 text-red-600 p-4 rounded-2xl font-bold italic">错误选择: {h.selected}</div>
                                                    <div className="bg-green-50 text-green-700 p-4 rounded-2xl font-bold">正确答案: {h.question.answer}</div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            const q = questions[currentIndex];
            const isFav = favorites.includes(q.id);

            return (
                <div className="min-h-screen p-4 flex flex-col items-center bg-slate-50">
                    <div className="w-full max-w-2xl flex justify-between items-center mb-8">
                        <div className="w-24">
                            {!exitConfirm ? (
                                <button onClick={() => setExitConfirm(true)} className="text-slate-400 hover:text-indigo-600 transition"><IconHome /></button>
                            ) : (
                                <div className="flex items-center space-x-2 animate-in bg-white p-1 rounded-full shadow-sm">
                                    <button onClick={() => setView('menu')} className="bg-red-500 text-white text-[10px] px-3 py-1.5 rounded-full font-bold">确认退出</button>
                                    <button onClick={() => setExitConfirm(false)} className="text-[10px] text-slate-400 font-bold px-2">取消</button>
                                </div>
                            )}
                        </div>
                        <div className="flex-1 text-center">
                            <span className="bg-white px-6 py-2 rounded-full shadow-sm text-xs font-black text-indigo-600 border border-indigo-100 uppercase tracking-widest">
                                {title} {currentIndex + 1}/{questions.length}
                            </span>
                        </div>
                        <div className="w-24 flex justify-end">
                            <button onClick={() => toggleFavorite(q.id)} className={`transition-transform hover:scale-125 ${isFav ? 'text-yellow-500' : 'text-slate-300'}`}>
                                <IconStar filled={isFav} />
                            </button>
                        </div>
                    </div>

                    <div className="w-full max-w-2xl bg-white p-8 md:p-14 rounded-[3rem] shadow-2xl space-y-10 animate-in border-b-[12px] border-indigo-600">
                        <div className="flex justify-between opacity-20 text-[10px] font-black uppercase tracking-[0.2em]">
                            <span>{q.chapter}</span>
                            <span>Q-ID: {q.id}</span>
                        </div>
                        <h2 className="text-2xl md:text-3xl font-black text-slate-800 leading-snug min-h-[6rem]">{q.question}</h2>
                        
                        <div className="space-y-4">
                            {q.options.map((opt, idx) => {
                                const isCorrect = opt === q.answer;
                                const isWrong = selected === opt && !isCorrect;
                                const showResult = selected !== null;
                                
                                let style = "bg-slate-50 border-slate-100 hover:bg-slate-100";
                                if (showResult) {
                                    if (isCorrect) style = "bg-green-100 border-green-500 text-green-800 scale-[1.03] shadow-lg z-10";
                                    else if (isWrong) style = "bg-red-100 border-red-500 text-red-700";
                                    else style = "bg-white border-slate-50 opacity-30";
                                }

                                return (
                                    <button key={opt} disabled={showResult} onClick={() => setSelected(opt)}
                                        className={`w-full p-6 text-left rounded-[2rem] border-2 transition-all duration-300 flex items-center group ${style}`}>
                                        <span className={`w-10 h-10 rounded-full border-2 flex items-center justify-center mr-5 font-black text-sm flex-shrink-0 transition-colors ${showResult ? 'border-transparent' : 'border-indigo-100 text-indigo-300'}`}>
                                            {showResult && isCorrect ? <IconCheck /> : showResult && isWrong ? <IconX /> : String.fromCharCode(65 + idx)}
                                        </span>
                                        <span className="font-bold text-lg leading-tight">{opt}</span>
                                    </button>
                                );
                            })}
                        </div>
                        
                        {selected && (
                            <div className="pt-6">
                                <button onClick={() => {
                                    const correct = selected === q.answer;
                                    if (correct) setScore(s => s + 1);
                                    setHistory([...history, { question: q, selected, isCorrect: correct }]);
                                    if (currentIndex < questions.length - 1) { setCurrentIndex(i => i + 1); setSelected(null); setExitConfirm(false); }
                                    else { setView('result'); }
                                }} className="w-full bg-indigo-600 text-white py-6 rounded-3xl font-black shadow-2xl hover:bg-indigo-700 transition-all flex items-center justify-center tracking-widest text-lg uppercase">
                                    <span>{currentIndex < questions.length - 1 ? "下一题 NEXT" : "查看结果 FINISH"}</span>
                                </button>
                            </div>
                        )}
                    </div>
                    
                    <div className="mt-12 w-full max-w-2xl bg-slate-200 h-2 rounded-full overflow-hidden shadow-inner">
                        <div className="bg-indigo-600 h-full transition-all duration-1000 ease-out" style={{ width: `${((currentIndex + 1) / questions.length) * 100}%` }}></div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
